{"version":3,"sources":["../server/index.js"],"names":["GRAPHQL_PORT","process","env","PORT","app","use","json","static","schema","graphiql","pretty","httpServer","listen","console","log","io","on","socket","request","subscribe","emit","updatedPayload","initialPayload"],"mappings":";;;;;;AAIA;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AAGA;;;;AACA;;;AAGA;AACA;;;AAhBA;AACA;AAgBA,IAAMA,eAAeC,QAAQC,GAAR,CAAYC,IAAZ,IAAoB,IAAzC;AACA;;AATA;AACA;AASA,IAAMC,MAAM,wBAAZ;AACAA,IAAIC,GAAJ,CAAQ,qBAAWC,IAAX,EAAR;AACA;AACA;AACAF,IAAIC,GAAJ,CAAQ,GAAR,EAAa,kBAAQE,MAAR,CAAe,eAAf,CAAb;AACAH,IAAIC,GAAJ,CAAQ,GAAR,EAAa,8BAAY,EAAEG,sBAAF,EAAUC,UAAU,IAApB,EAA0BC,QAAQ,IAAlC,EAAZ,CAAb;AACA;;AAEA,IAAMC,aAAaP,IAAIQ,MAAJ,CAAWZ,YAAX,EAAyB;AAAA,SAAMa,QAAQC,GAAR,wDACKd,YADL,CAAN;AAAA,CAAzB,CAAnB;;AAIA,IAAMe,KAAK,sBAAGJ,UAAH,CAAX;AACAI,GAAGC,EAAH,CAAM,YAAN,EAAoB,kBAAU;AAC5BC,SAAOD,EAAP,CAAU,sBAAV;AAAA,qFAAkC,iBAAME,OAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACL,8BAAoBC,SAApB,CAA8BD,OAA9B,EAAuC,0BAAkB;AAClFD,uBAAOG,IAAP,CAAY,sBAAZ,EAAoCC,cAApC;AACD,eAF0B,CADK;;AAAA;AAC5BC,4BAD4B;;AAIhCL,qBAAOG,IAAP,CAAY,sBAAZ,EAAoCE,cAApC;;AAJgC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAlC;;AAAA;AAAA;AAAA;AAAA;AAMD,CAPD","file":"index.js","sourcesContent":["// @flow\n\n// require('babel-polyfill'); doesn't work!\n// If you are using ES6’s import syntax in your application’s entry point, you should instead import the polyfill at the top of the entry point to ensure the polyfills are loaded first\nimport 'babel-polyfill';\nimport express from 'express';\nimport bodyParser from 'body-parser';\nimport graphQLHTTP from 'express-graphql';\nimport { schema } from './data/schema';\nimport IO from 'socket.io';\nimport subscriptionHandler from './subscriptionHandler';\n//if you don't have below line, nodemon won't re-load generateSchemaJson, \n//and as such your old schema.json is used\nimport './scripts/updateSchema';\n//******************************* end import  *************************************************/\n\n\n//however you don't have to explicitly call the generateSchemaJSON method, as it's automatically \n//callel everytime the file is loaded (node loads that module)\nconst GRAPHQL_PORT = process.env.PORT || 8081;\n// Expose a GraphQL endpoint\nconst app = express();\napp.use(bodyParser.json());\n// *********************************************************************************\n// must be the right order; static file first!\napp.use('/', express.static('heroku/public'));\napp.use('/', graphQLHTTP({ schema, graphiql: true, pretty: true }));\n// *********************************************************************************\n\nconst httpServer = app.listen(GRAPHQL_PORT, () => console.log(\n  `GraphQL Server is now running on http://localhost:${GRAPHQL_PORT}`\n));\n\nconst io = IO(httpServer);\nio.on('connection', socket => {\n  socket.on('graphql:subscription', async request => {\n    var initialPayload = await subscriptionHandler.subscribe(request, updatedPayload => {\n      socket.emit('graphql:subscription', updatedPayload);\n    });\n    socket.emit('graphql:subscription', initialPayload);\n  });\n});\n\n"]}